{
  "$schema": "../schemas/current-test-task.schema.json",
  "schemaVersion": "2.0.0",
  "metadata": {
    "projectName": "{{PROJECT_NAME}}",
    "sprintId": "{{SPRINT_ID}}",
    "taskId": "{{TASK_ID}}",
    "taskTitle": "{{TASK_TITLE}}",
    "generatedAt": "{{GENERATED_AT}}",
    "generatedBy": "CODOR Template Generator",
    "description": "Auto-generated from component-test-template.json",
    "references": []
  },
  "globalConfiguration": {
    "workspaceRoot": "{{WORKSPACE_ROOT}}",
    "evidenceDirectory": "evidence",
    "devServer": {
      "command": "npm run dev",
      "workingDirectory": "{{WORKSPACE_ROOT}}/packages/web",
      "port": 3000,
      "healthCheckUrl": "http://localhost:3000",
      "startupTimeout": 30000
    },
    "environment": {
      "NODE_ENV": "test"
    },
    "timeout": "{{GLOBAL_TIMEOUT}}",
    "validationPolicy": {
      "linting": {
        "strategy": "{{ESLINT_STRATEGY}}",
        "tools": {
          "eslint": {
            "enabled": true,
            "blockOn": "{{ESLINT_BLOCK_ON}}",
            "maxWarnings": "{{MAX_WARNINGS}}",
            "ignoredRules": "{{IGNORED_RULES}}",
            "errorOnRules": "{{ERROR_ON_RULES}}"
          }
        }
      },
      "typeChecking": {
        "strategy": "{{TYPESCRIPT_STRATEGY}}",
        "tools": {
          "typescript": {
            "enabled": true,
            "blockOn": "{{TYPESCRIPT_BLOCK_ON}}",
            "strictMode": "{{STRICT_MODE}}",
            "allowImplicitAny": false
          }
        }
      },
      "compilation": {
        "strategy": "BLOCK_ON_ERRORS_ALWAYS"
      }
    }
  },
  "executionEngine": {
    "availableActionTypes": ["TERMINAL_COMMAND", "FILE_VALIDATION"],
    "executorConfigurations": {
      "terminalCommand": {
        "shell": "powershell",
        "timeout": 60000
      }
    }
  },
  "tasks": {
    "{{TASK_ID}}": {
      "taskId": "{{TASK_ID}}",
      "title": "{{TASK_TITLE}}",
      "description": "{{TASK_DESCRIPTION}}",
      "priority": "{{PRIORITY}}",
      "dependencies": "{{DEPENDENCIES}}",

      "testExecution": {
        "prerequisites": [
          {
            "actionId": "PREREQ.1",
            "type": "FILE_VALIDATION",
            "description": "Verify component file exists",
            "parameters": {
              "filePath": "{{COMPONENT_PATH}}",
              "validationType": "EXISTS"
            },
            "timeout": 5000,
            "continueOnFailure": false
          },
          {
            "actionId": "PREREQ.2",
            "type": "FILE_VALIDATION",
            "description": "Verify test file exists",
            "parameters": {
              "filePath": "{{TEST_FILE_PATH}}",
              "validationType": "EXISTS"
            },
            "timeout": 5000,
            "continueOnFailure": false
          },
          {
            "actionId": "PREREQ.3",
            "type": "TERMINAL_COMMAND",
            "description": "Install dependencies",
            "parameters": {
              "command": "npm install",
              "workingDirectory": "{{WORKSPACE_ROOT}}/packages/web",
              "environment": {
                "NODE_ENV": "test"
              }
            },
            "timeout": 120000,
            "continueOnFailure": false
          }
        ],

        "steps": [
          {
            "actionId": "STEP.1",
            "type": "TERMINAL_COMMAND",
            "description": "TypeScript type check",
            "parameters": {
              "command": "npx tsc --noEmit --project tsconfig.json",
              "workingDirectory": "{{WORKSPACE_ROOT}}/packages/web"
            },
            "timeout": 60000,
            "continueOnFailure": false
          },
          {
            "actionId": "STEP.2",
            "type": "TERMINAL_COMMAND",
            "description": "ESLint validation",
            "parameters": {
              "command": "npx eslint {{TEST_FILE_PATH}}",
              "workingDirectory": "{{WORKSPACE_ROOT}}/packages/web"
            },
            "timeout": 30000,
            "continueOnFailure": false
          },
          {
            "actionId": "STEP.3",
            "type": "TERMINAL_COMMAND",
            "description": "Execute component test suite",
            "parameters": {
              "command": "npm test -- {{TEST_FILE_PATH}} --verbose",
              "workingDirectory": "{{WORKSPACE_ROOT}}/packages/web",
              "environment": {
                "NODE_ENV": "test"
              }
            },
            "timeout": 60000,
            "continueOnFailure": true
          },
          {
            "actionId": "STEP.4",
            "type": "TERMINAL_COMMAND",
            "description": "Run component tests with coverage",
            "parameters": {
              "command": "npm test -- {{TEST_FILE_PATH}} --coverage --coverageReporters=json --coverageThreshold='{\"global\":{\"lines\":{{COVERAGE_THRESHOLD}}}}'",
              "workingDirectory": "{{WORKSPACE_ROOT}}/packages/web"
            },
            "timeout": 60000,
            "continueOnFailure": true
          }
        ],

        "cleanup": [
          {
            "actionId": "CLEANUP.1",
            "type": "TERMINAL_COMMAND",
            "description": "Clear test cache",
            "parameters": {
              "command": "npm run test:clear-cache",
              "workingDirectory": "{{WORKSPACE_ROOT}}/packages/web"
            },
            "timeout": 10000,
            "continueOnFailure": true
          }
        ]
      },

      "validationCriteria": {
        "successConditions": [
          {
            "condition": "STEP.3.exitCode === 0 || STEP.3.exitCode === 1",
            "description": "Test suite executes successfully (TDD allows test failures)"
          },
          {
            "condition": "STEP.1.exitCode === 0",
            "description": "No TypeScript compilation errors"
          },
          {
            "condition": "STEP.2.errorCount === 0",
            "description": "No ESLint errors (per validation policy)"
          }
        ],
        "failureConditions": [
          {
            "condition": "PREREQ.1.failed === true",
            "description": "Component file not found (blocks execution)"
          },
          {
            "condition": "PREREQ.2.failed === true",
            "description": "Test file not found (blocks execution)"
          },
          {
            "condition": "STEP.1.exitCode !== 0",
            "description": "TypeScript errors present (blocks execution per policy)"
          }
        ],
        "expectedOutput": {
          "stdoutContains": ["Test Suites:", "Tests:", "{{COMPONENT_NAME}}"],
          "exitCode": 0
        }
      },

      "completionCriteria": {
        "allStepsMustPass": "{{ALL_STEPS_MUST_PASS}}",
        "minimumPassRate": "{{MINIMUM_PASS_RATE}}",
        "requiredEvidence": ["terminal-output", "test-execution-log"],
        "taskStatusLock": true
      },

      "technicalDebtExpectations": {
        "likelyFailures": [
          {
            "scenario": "Component not rendering correctly",
            "expectedDebtCategory": "INTEGRATION_FAILURE",
            "expectedSeverity": "HIGH",
            "suggestedFix": "Fix component rendering logic, check props and state management"
          },
          {
            "scenario": "Props validation failing",
            "expectedDebtCategory": "VALIDATION_MISSING",
            "expectedSeverity": "MEDIUM",
            "suggestedFix": "Add or fix PropTypes/TypeScript interface definitions for component props"
          },
          {
            "scenario": "Accessibility violations detected",
            "expectedDebtCategory": "VALIDATION_MISSING",
            "expectedSeverity": "HIGH",
            "suggestedFix": "Add ARIA attributes, improve semantic HTML, fix keyboard navigation"
          },
          {
            "scenario": "Event handlers not triggering",
            "expectedDebtCategory": "BUSINESS_LOGIC_ERROR",
            "expectedSeverity": "MEDIUM",
            "suggestedFix": "Verify event binding, check callback implementation"
          },
          {
            "scenario": "Coverage below threshold",
            "expectedDebtCategory": "VALIDATION_MISSING",
            "expectedSeverity": "LOW",
            "suggestedFix": "Add test cases for uncovered code paths, edge cases, and error scenarios"
          }
        ]
      }
    }
  }
}
